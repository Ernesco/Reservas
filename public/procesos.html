<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script type="text/javascript">document.oncontextmenu = function(){return false;}</script>
    <link rel="stylesheet" href="style.css">
    <title>Manual de Procesos</title>
    <style>
        .paso-caja { background: #313244; padding: 20px; border-radius: 12px; margin-bottom: 20px; border-left: 5px solid #89b4fa; }
        .paso-titulo { color: #89b4fa; font-weight: bold; font-size: 1.1em; margin-bottom: 10px; display: flex; align-items: center; gap: 10px; }
        .paso-texto { color: #cdd6f4; font-size: 0.95em; line-height: 1.5; }
        .proceso-badge { background: #fab387; color: #11111b; padding: 2px 8px; border-radius: 4px; font-weight: bold; font-size: 0.8em; }
    </style>
</head>
<body>

    <header>
        <div class="logo-texto">üìñ MANUAL DE OPERACIONES</div>
        <a href="panel.html" class="btn-header">üè† INICIO</a>
    </header>

    <main style="max-width: 800px; margin: 40px auto; padding: 0 20px;">
        <h2 style="color: #4a90e2; text-align: center; margin-bottom: 30px;">Gu√≠a R√°pida para Operadores</h2>

        <div class="paso-caja">
            <div class="paso-titulo"><span>1Ô∏è‚É£</span> ¬øC√≥mo cargar una reserva? <span class="proceso-badge">LOCAL ORIGEN</span></div>
            <div class="paso-texto">
                <ul>
                    <li>And√° a <b>Nueva Reserva</b> y carg√° los datos del cliente.</li>
                    <li>Ingres√° el c√≥digo del producto y presion√° <b>TAB</b> para autocompletar precio y descripci√≥n.</li>
                    <li><b>IMPORTANTE:</b> Llam√° al local que tiene el stock antes de guardar para confirmar disponibilidad.</li>
                    <li>Ingres√° el nombre de quien te atendi√≥ y guard√° la reserva. El cliente recibir√° un mail de confirmaci√≥n.</li>
                </ul>
            </div>
        </div>

        <div class="paso-caja" style="border-left-color: #a6e3a1;">
            <div class="paso-titulo"><span>2Ô∏è‚É£</span> ¬øQu√© hacer cuando llega un producto? <span class="proceso-badge">LOCAL DESTINO</span></div>
            <div class="paso-texto">
                <ul>
                    <li>And√° a <b>Ver Lista de Reservas</b> y filtr√° por <b>"En Tr√°nsito"</b>.</li>
                    <li>Busc√° el pedido que acaba de llegar (us√° el buscador por cliente o c√≥digo).</li>
                    <li>Hac√© clic en el bot√≥n azul <b>"LLEG√ì AL LOCAL"</b>.</li>
                    <li>Ingres√° tu nombre. El sistema enviar√° autom√°ticamente un mail al cliente avis√°ndole.</li>
                </ul>
            </div>
        </div>

        <div class="paso-caja" style="border-left-color: #fab387;">
            <div class="paso-titulo"><span>3Ô∏è‚É£</span> Entrega final al cliente <span class="proceso-badge">ENTREGA</span></div>
            <div class="paso-texto">
                <ul>
                    <li>Filtr√° la lista por <b>"Pendiente de Retiro"</b>.</li>
                    <li>Cuando el cliente se presente, hac√© clic en el bot√≥n verde <b>"RETIRADO"</b>.</li>
                    <li>Ingres√° tu nombre para finalizar. El registro pasar√° a la pesta√±a <b>"Finalizado"</b>.</li>
                </ul>
            </div>
        </div>
    </main>

    <footer>
        <div class="footer-creador-container">
            <span class="texto-creado">Creado por:</span>
            <img src="./img/New_Logo_OB.png" alt="One Box Logo" class="footer-logo">
        </div>

        <div class="footer-centro">
            <div class="footer-links">
                <a href="soporte.html" onclick="registrarOrigenSoporte()">Soporte</a>
            </div>
            <p>&copy; 2026 Tu Sistema de Reservas. Todos los derechos reservados.</p>
        </div>

        <div class="footer-version-container">
            <div class="footer-version">v4.5.0</div>
        </div>
    </footer>

    <script>
        function registrarOrigenSoporte() {
            // Obtenemos el nombre del archivo actual (ej: login.html)
            const paginaActual = window.location.pathname.split('/').pop() || 'Inicio';
            sessionStorage.setItem('origen_soporte', paginaActual);
        }
    </script>

    <div id="modalSoporte" class="modal-overlay">
        <div class="modal-caja">
            <h3 style="color: #89b4fa;">üõ†Ô∏è Soporte T√©cnico</h3>
            <form id="formSoporte">
                <label style="color: #bac2de;">Tipo de solicitud:</label>
                <select id="tipo_ticket" required>
                    <option value="Falla">Reportar Falla</option>
                    <option value="Modificacion">Solicitar Modificaci√≥n</option>
                    <option value="Sugerencia">Sugerencia</option>
                </select>
                <label style="color: #bac2de; margin-top: 10px;">Descripci√≥n detallada:</label>
                <textarea id="desc_ticket" required placeholder="Describe el problema o sugerencia..."></textarea>
                <div class="modal-botones">
                    <button type="submit" class="btn-azul">ENVIAR TICKET</button>
                    <button type="button" onclick="cerrarSoporte()" class="btn-secundario">CANCELAR</button>
                </div>
            </form>
        </div>
    </div>

    <div id="modalAviso" class="modal-overlay">
        <div class="modal-caja" id="bordeModal">
            <h3 id="tituloAviso"></h3>
            <p id="textoAviso" style="color: #fff; margin-bottom: 20px;"></p>
            <div class="modal-botones">
                <button onclick="cerrarAviso()" class="btn-azul" id="btnColorAviso">Aceptar</button>
            </div>
        </div>
    </div>

    <script>
        // --- SEGURIDAD Y SESI√ìN ---
        if (!sessionStorage.getItem('usuario_nombre')) {
            window.location.href = 'index.html';
        }

        // --- GESTI√ìN DE MODALES ---
        function mostrarAviso(titulo, mensaje, esError = true) {
            const modal = document.getElementById('modalAviso');
            const tituloH3 = document.getElementById('tituloAviso');
            const textoP = document.getElementById('textoAviso');
            const borde = document.getElementById('bordeModal');
            const btn = document.getElementById('btnColorAviso');
            tituloH3.textContent = titulo;
            textoP.textContent = mensaje;
            const color = esError ? '#f38ba8' : '#a6e3a1';
            tituloH3.style.color = color;
            borde.style.borderColor = color;
            btn.style.backgroundColor = color;
            modal.style.display = 'flex';
        }

        function cerrarAviso() { document.getElementById('modalAviso').style.display = 'none'; }
        function abrirSoporte() { document.getElementById('modalSoporte').style.display = 'flex'; }
        function cerrarSoporte() { document.getElementById('modalSoporte').style.display = 'none'; }

        // --- ENV√çO DE SOPORTE ---
        document.getElementById('formSoporte').addEventListener('submit', async function(e) {
            e.preventDefault();
            const datos = {
                tipo: document.getElementById('tipo_ticket').value,
                descripcion: document.getElementById('desc_ticket').value,
                usuario: sessionStorage.getItem('usuario_nombre') || 'Lector Manual'
            };
            try {
                const res = await fetch('/enviar-ticket', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(datos)
                });
                if (res.ok) {
                    cerrarSoporte();
                    this.reset();
                    mostrarAviso('‚úÖ Enviado', 'Tu consulta de soporte fue enviada con √©xito.', false);
                } else {
                    mostrarAviso('‚ùå Error', 'No se pudo enviar el ticket.', true);
                }
            } catch {
                mostrarAviso('‚ùå Error', 'Falla de conexi√≥n con el servidor.', true);
            }
        });
    </script>
</body>
</html>