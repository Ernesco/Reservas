<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script type="text/javascript">document.oncontextmenu = function(){return false;}</script>
    <title>One Box - Panel de Control</title>
    <link rel="stylesheet" href="style.css">
</head>
<body> 
    <header>    
        <div class="logo-texto">üì¶ Area de selecci√≥n</div>
        <a href="#" id="btnSalir" class="btn-header">üö™ SALIR</a>
    </header>

    <div id="panel-box" class="caja-central">
        <h1>Panel de Control</h1>
        <p style="color: #444; margin-bottom: 30px; font-weight: 500;">Seleccione una operaci√≥n para continuar:</p>

        <div class="contenedor-menu" id="contenedor-botones">
            <a href="formulario.html" class="btn-menu">‚ûï Nueva Reserva</a>
            <a href="lista.html" class="btn-menu">üìã Ver Lista de Reservas</a>
            <a href="procesos.html" class="btn-menu" style="background-color: #585b70;">üìñ Manual de Procesos</a>
            <a href="actualizar.html" class="btn-menu btn-destacado" id="btnActualizar">üìà Actualizar Precios</a>
            
            </div>
    </div>

    <footer>
        <div class="footer-links">
            <a href="javascript:void(0)" onclick="abrirSoporte()">Soporte</a>
        </div>
            <img src="./img/Ob_Logo.png" alt="One Box Logo" class="footer-logo">
            <p>&copy; 2026 Tu Sistema de Reservas. Todos los derechos reservados.</p>
        <div class="footer-version">v1.3.0</div> 
    </footer>

    <div id="modalSoporte" class="modal-overlay">
        <div class="modal-caja">
            <h3 style="color: #89b4fa;">üõ†Ô∏è Soporte T√©cnico</h3>
            <form id="formSoporte">
                <label style="color: #bac2de;">Tipo de solicitud:</label>
                <select id="tipo_ticket" required>
                    <option value="Falla">Reportar Falla</option>
                    <option value="Modificacion">Solicitar Modificaci√≥n</option>
                    <option value="Sugerencia">Sugerencia</option>
                </select>
                <label style="color: #bac2de; margin-top: 10px;">Descripci√≥n detallada:</label>
                <textarea id="desc_ticket" required placeholder="Describe el problema o sugerencia..."></textarea>
                <div class="modal-botones">
                    <button type="submit" class="btn-azul">ENVIAR TICKET</button>
                    <button type="button" onclick="cerrarSoporte()" class="btn-secundario">CANCELAR</button>
                </div>
            </form>
        </div>
    </div>

    <div id="modalAviso" class="modal-overlay">
        <div class="modal-caja" id="bordeModal">
            <h3 id="tituloAviso"></h3>
            <p id="textoAviso" style="color: #fff; margin-bottom: 20px;"></p>
            <div class="modal-botones">
                <button onclick="cerrarAviso()" class="btn-azul" id="btnColorAviso">Aceptar</button>
            </div>
        </div>
    </div>

    <script>
        // --- SEGURIDAD Y SESI√ìN ---
        if (!sessionStorage.getItem('usuario_nombre')) {
            window.location.href = 'index.html';
        }

        const nombre = sessionStorage.getItem('usuario_nombre');
        const sucursal = sessionStorage.getItem('usuario_sucursal');
        const rol = sessionStorage.getItem('usuario_rol'); 

        if (nombre) {
            document.querySelector('h1').innerHTML = `Hola, <span style="color:#4a90e2">${sucursal}</span>`;
        }

        // --- L√ìGICA DE BOTONES SEG√öN ROL ---
        const contenedor = document.getElementById('contenedor-botones');

        if (rol === 'admin') {
            // Inyectamos botones administrativos
            contenedor.innerHTML += `
                <a href="sucursales.html" class="btn-menu" style="border: 2px solid #fab387; background: transparent; color: #fab387;">‚öôÔ∏è Configurar Locales</a>
                <a href="usuarios.html" class="btn-menu" style="border: 2px solid #89b4fa; background: transparent; color: #89b4fa;">üë• Gesti√≥n de Usuarios</a>
            `;
        } else {
            // Si no es admin, ocultamos el bot√≥n de actualizaci√≥n masiva
            const btnActualizar = document.getElementById('btnActualizar');
            if(btnActualizar) btnActualizar.style.display = 'none';
        }

        // Bot√≥n Salir
        document.getElementById('btnSalir').addEventListener('click', (e) => {
            e.preventDefault();
            sessionStorage.clear();
            window.location.href = 'index.html';
        });

        // --- GESTI√ìN DE MODALES (SOPORTE Y AVISOS) ---
        function mostrarAviso(titulo, mensaje, esError = true) {
            const modal = document.getElementById('modalAviso');
            const tituloH3 = document.getElementById('tituloAviso');
            const textoP = document.getElementById('textoAviso');
            const borde = document.getElementById('bordeModal');
            const btn = document.getElementById('btnColorAviso');
            tituloH3.textContent = titulo;
            textoP.textContent = mensaje;
            const color = esError ? '#f38ba8' : '#a6e3a1';
            tituloH3.style.color = color;
            borde.style.borderColor = color;
            btn.style.backgroundColor = color;
            modal.style.display = 'flex';
        }

        function cerrarAviso() { document.getElementById('modalAviso').style.display = 'none'; }
        function abrirSoporte() { document.getElementById('modalSoporte').style.display = 'flex'; }
        function cerrarSoporte() { document.getElementById('modalSoporte').style.display = 'none'; }

        // --- ENV√çO DE SOPORTE ---
        document.getElementById('formSoporte').addEventListener('submit', async function(e) {
            e.preventDefault();
            const datos = {
                tipo: document.getElementById('tipo_ticket').value,
                descripcion: document.getElementById('desc_ticket').value,
                usuario: sessionStorage.getItem('usuario_nombre') || 'Usuario Panel'
            };
            try {
                const res = await fetch('/enviar-ticket', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(datos)
                });
                if (res.ok) {
                    cerrarSoporte();
                    this.reset();
                    mostrarAviso('‚úÖ Enviado', 'Ticket de soporte recibido correctamente.', false);
                } else {
                    mostrarAviso('‚ùå Error', 'No se pudo enviar el ticket.', true);
                }
            } catch {
                mostrarAviso('‚ùå Error', 'Falla de red.', true);
            }
        });
    </script>
</body>
</html>